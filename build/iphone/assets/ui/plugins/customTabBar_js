var createCustomTabGroup=function(e){function f(e){t.addTab(e),e.tabBarHidden===!0&&(Ti.API.info("tabBarHidden is not currently supported by CustomTabBar and will be ignored"),delete e.tabBarHidden);if(e.custom==1){fakeTabBg=Ti.UI.createView({height:49,index:t.tabs.length-1,bottom:0,backgroundImage:"/tabbar_module/images/tabbar.png",defaultImage:"/tabbar_module/images/tabbar.png",selectedImage:e.selectedImage||"/tabbar_module/images/tabbar_h.png",borderRadius:8}),tabImage=Ti.UI.createImageView({image:t.tabs[t.tabs.length-1].icon,defaultImage:t.tabs[t.tabs.length-1].icon,selectedImage:t.tabs[t.tabs.length-1].selectedIcon,bottom:0,index:t.tabs.length-1,height:49,width:t.tabs[t.tabs.length-1].imageWidth||"auto",touchEnabled:!1,preventDefaultImage:!0}),e.title!==undefined&&(tabTitle=Ti.UI.createLabel({text:e.title,bottom:0,height:"auto",width:"auto",font:{fontSize:10,fontWeight:"bold"},color:"#fff",touchEnabled:!1}),tabImage.bottom=0,fakeTabBg.add(tabTitle));if(e.badge!==null)throw"CustomTabGroup error: badges can not be set on custom tabs";if(e.modal===!0&&t.tabs.length==1)throw"CustomTabGroup error: The first window can not be a modal window";e.modal===!0?fakeTabBg.addEventListener("click",function(t){e.window.open({modal:!0})}):typeof e.onClick=="function"?(fakeTabBg.touchEnabled=!0,fakeTabBg.addEventListener("click",function(t){e.onClick()})):fakeTabBg.touchEnabled=!1,e.custom!==undefined||e.custom===!0?(r.push(tabImage),e.tabHeight>u&&(u=e.tabHeight)):(r.push({index:t.tabs.length-1}),fakeTabBg.add(tabImage),e.badge!==undefined),n.push(fakeTabBg)}else n.push(!1),r.push(!1);return}function l(){for(i=0;i<n.length;i++)if(n[i]!==!1){var e;a?width=80:(e=(t.tabs.length-1)*2,width=t.width/t.tabs.length-e);if(a){switch(t.tabs.length){case 2:e=26;break;case 3:e=32;break;case 4:e=31.5;break;case 5:case 6:case 7:e=30;break;default:e=0}var s=n.length*width+(n.length-1)*e;base_left=t.width/2-s/2,s=null;var o=base_left+(n[i].index*width+e*i)}else{base_left=0;var o=n[i].index===0?4:width*n[i].index+(4+e*n[i].index);Ti.API.info(o)}n[i].width=width,n[i].left=o,t.tabs[n[i].index].custom===!0&&(r[i].height=t.tabs[r[i].index].imageHeight>49?t.tabs[r[i].index].imageHeight:49,t.tabs[n[i].index].imageWidth!==undefined&&t.tabs[n[i].index].imageWidth>=width&&(offset=(t.tabs[n[i].index].imageWidth-width)/2,r[i].width=t.tabs[n[i].index].imageWidth,r[i].left=o-offset))}}function c(){l();for(i=0;i<n.length;i++)n[i]!==!1&&(t.add(n[i]),t.tabs[n[i].index].custom===!0&&(t.tabs[n[i].index].imageWidth!==undefined&&t.tabs[n[i].index].imageWidth>=width?(t.add(r[i]),t.tabs[i].icon=null):(n[i].add(r[i]),t.tabs[i].icon=null)));t.addEventListener("focus",function(e){t._activeTab=e.tab,t._activeTabIndex=e.index;if(t._activeTabIndex==-1)return;s=t._activeTab,o=t._activeTabIndex}),Ti.Gesture.addEventListener("orientationchange",function(e){setTimeout(function(){l()},200)}),t.addEventListener("focus",function(e){e.previousIndex!==undefined&&e.previousIndex>=0&&n[e.previousIndex]!==undefined&&(n[e.previousIndex].backgroundImage=n[e.index].defaultImage),e.index!==undefined&&e.index>=0&&n[e.index]!==undefined&&(n[e.index].backgroundImage=n[e.index].selectedImage)}),t.open();return}function h(e){if(e.custom==1)throw"CustomTabGroup error: Custom tabs can not be removed...";t.removeTab(e);return}function p(e){typeof e=="number"&&(e=t.tabs[e]),e.modal==1?e.window.open({modal:!0}):t.setActiveTab(e);return}function d(){down=u+2,t.animate({bottom:-down,duration:0})}function v(){t.animate({bottom:0,duration:0})}if(Ti.Platform.name=="android")throw"CustomTabGroup error: This is only supported by iPhone!";var t=Ti.UI.createTabGroup(e),n=[],r=[],s={},o=0,u=50,a=Ti.Platform.model!=="iPad"&&Ti.Platform.model!=="iPad Simulator"?!1:!0;return{open:function(){c()},addTab:function(e){f(e)},removeTab:function(e){h(e)},setActiveTab:function(e){p(e)},hideTabBar:function(){d()},showTabBar:function(){v()},remove:function(e){t.remove(e)},addEventListener:function(e,n){t.addEventListener(e,n)},animate:function(e){t.animate(e)},close:function(){t.close()},fireEvent:function(e){t.fireEvent(e)},removeEventListener:function(e,n){t.removeEventListener(e,n)},add:function(e){t.add(e)},hide:function(){t.hide()},show:function(){t.show()},toImage:function(){t.toImage()},tabs:t.tabs,currentTab:s,currentTabIndex:o}}