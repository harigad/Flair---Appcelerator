function _del(e){var t=Ti.UI.createAlertDialog({cancel:-1,buttonNames:["Delete","Cancel"],message:"Delete Comment?"});t.addEventListener("singletap",function(t){Ti.API.debug("edit share dialog button clicked with index "+t.index),t.index===0&&(process(e._data,"delete"),view.remove(e))}),t.show()}function _commentsField(e){var t=Ti.UI.createView({height:"auto",backgroundColor:"#eee",width:300,borderRadius:4,top:5,bottom:5}),n=Ti.UI.createTextField({value:"",height:40,left:10,right:10,hintText:"add comment",borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,_fid:e});return n.addEventListener("return",function(e){Ti.API.debug("return clicked "+this.value);if(this.value!==""){var t={};t.uid=user.getId(),t.name=user.getName(),t.photo=user.getPhoto(),t.coid="",t.data=this.value,t.likes=0,t.fid=this._fid;var n=_create(t,!0);view.add(n),process(t,"add",n)}}),t.add(n),t}function _hr(){return Ti.UI.createView({backgroundImage:"images/feed/hr.png",backgroundRepeat:!0,height:2,width:"100%"})}function _create(e,t){Ti.API.debug("creating comment");var n=Ti.UI.createImageView({image:e.photo,width:"50",height:"50",left:10,top:8,bottom:5}),r=Ti.UI.createView({left:5,top:8,width:220,height:"auto",layout:"vertical"}),i=Ti.UI.createLabel({height:"auto",left:0,width:"auto",text:e.name,borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,color:"#2179ca",font:{fontSize:14}}),s=Ti.UI.createLabel({height:"auto",left:0,width:"auto",text:e.data,borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,font:{fontSize:14},color:"#666"});r.add(i),r.add(s);var o=Ti.UI.createView({left:0,bottom:5,top:0,height:"auto",layout:"horizontal"}),u=Ti.UI.createImageView({image:"images/feed/like_blue.png",left:0,right:10,top:0,height:15,_title:"_like"});u.addEventListener("singletap",function(){e.liked?(this.setImage("images/feed/like_blue.png"),e.liked=!1):(this.setImage("images/feed/liked.png"),e.liked=!0)});var a=require("ui/common/feed/Likes");r.add(a.init(e)),r.add(o);var f=Ti.UI.createView({backgroundColor:"#fff",left:10,right:10,height:"auto",borderRadius:4,bottom:2,layout:"horizontal",coid:e.coid,_data:e,_name_txt:i,_comments_txt:s});return t==1&&f.add(_hr()),f.add(n),f.add(r),e.uid!==user.getId()?f.addEventListener("singletap",function(){_del(this)}):(f.addEventListener("singletap",function(e){if(e.source._title!="like"){this._cancelClick=!0,this.setBackgroundColor("#fff"),this._name_txt.setColor("#2179ca"),this._comments_txt.setColor("#666");var t=require("ui/common/userProfile/UserProfile");portal.open(t.init(this._data.uid,this._data.name,this._data.photo))}}),f.addEventListener("touchstart",function(e){this._cancelClick=!1;var t=this;e.source._title!="like"&&setTimeout(function(){t._cancelClick!==!0&&(t.setBackgroundColor("#2179ca"),t._name_txt.setColor("#fff"),t._comments_txt.setColor("#fff"))},300)}),f.addEventListener("touchend",function(e){this.setBackgroundColor("#fff"),this._name_txt.setColor("#2179ca"),this._comments_txt.setColor("#666")}),f.addEventListener("touchmove",function(e){this._cancelClick=!0,this.setBackgroundColor("#fff"),this._name_txt.setColor("#2179ca"),this._comments_txt.setColor("#666")})),f}function process(e,t,n){var r=this,i="http://flair.me/search.php",s="&type=comments&action="+t;s=s+"&coid="+e.coid+"&data="+e.data+"&fid="+e.fid,s=s+"&accessToken="+Ti.Facebook.getAccessToken();var o=Ti.Network.createHTTPClient({onload:function(e){Ti.API.debug("loaded data from addComment "),this.responseText&&n?(Ti.API.debug("loaded data for addComment status=true"),n.coid=this.responseText):Ti.API.debug("loaded data for editShare status=false")},onerror:function(e){Ti.API.error(e.error)},timeout:5e3});o.open("POST",i),o.send(s)}function loadAndPrint(e){var t=this;_clearView();var n=Ti.UI.createImageView({image:"images/loading_white.gif",width:"150",top:0});view.add(n);var r="http://flair.me/search.php",i="&type=comments&action=get";i=i+"&fid="+e,i=i+"&accessToken="+Ti.Facebook.getAccessToken();var s=Ti.Network.createHTTPClient({onload:function(e){_clearView(),Ti.API.debug("loaded data from addComment ");var t=JSON.parse(this.responseText);if(t)for(var n=0;n<t.length;n++)n==0?view.add(_create(t[n],!1)):view.add(_create(t[n],!0));else Ti.API.error("cannot load comments "+this.responseText)},onerror:function(e){Ti.API.error(e.error)},timeout:5e3});s.open("POST",r),s.send(i)}function _clearView(){for(var e=0;e<view.children.length;e++){Ti.API.debug("_clearView: deleting children "+e);var t=view.children[e];view.remove(t)}}var loading,view,portal=require("ui/common/Portal"),login=require("ui/common/Login"),user=login.getUser();exports.init=function(e){Ti.API.debug("printing feedProfile");var t=Ti.UI.createWindow({backgroundColor:"#fff",title:"details",barColor:"#aaa",barImage:"images/headerBg.jpg"}),n=Ti.UI.createScrollView({contentWidth:"auto",contentHeight:"auto",showVerticalScrollIndicator:!1,showHorizontalScrollIndicator:!1,width:320,top:0}),r=Ti.UI.createView({width:"100%",height:"auto",layout:"vertical"});view=Ti.UI.createView({width:"100%",height:"auto",top:2,layout:"vertical"});var i=require("ui/common/feed/FeedItem");r.add(i.feedItem(e,!0)),r.add(_commentsField(e.fid)),r.add(view),n.add(r),t.add(n),portal.open(t),loadAndPrint(e.fid)}