function User(e,t,n){Ti.API.debug("User.init "+e),this.id=e,n?this._data=n:this.load(t)}function setUserData(e,t){Ti.App.Properties.setString("userData_"+e,JSON.stringify(t))}function getUserData(e){if(e.indexOf("pid")>-1)return getNullUserData(e);var t=Ti.App.Properties.getString("userData_"+e);return t?JSON.parse(t):!1}function getNullUserData(e){var t=e.split("|"),n=t[0].split(":"),r=t[1].split(":"),i=t[2].split(":"),s=n[1],o=r[1],u={photo_big:i[1],feed:[],place:{pid:s,name:o,role:"Unregistered Cast Member"}};return u}var portal=require("ui/common/Portal");User.prototype.load=function(e){Ti.API.debug("User.load "+this.id);var t=this,n=getUserData(this.id);if(n){this.id.indexOf("pid")>-1&&(this.id=null),this._data=n,e(this);return}var r="http://flair.me/search.php",n={type:"user",id:this.id,accessToken:Ti.Facebook.getAccessToken()};Ti.API.debug("User.load sending data "+n);var i=Ti.Network.createHTTPClient({onload:function(n){Ti.API.debug("User.load recieved data "+this.responseText);var r=JSON.parse(this.responseText);r.status&&(t._data=r,t.id=t._data.id,setUserData(t.id,r)),e(t)},onerror:function(e){Ti.API.error("User.load error "+e)}});i.open("POST",r),i.send(n)},User.prototype.getId=function(){return this.id},User.prototype.setPlace=function(e){this._data.place=e},User.prototype.getPlace=function(){return this._data.place?this._data.place:!1},User.prototype.getName=function(){return this._data.name},User.prototype.getPhoto=function(){return this._data.photo},User.prototype.getPhotoBig=function(){return this._data.photo_big},User.prototype.feed=function(){return this._data.feed},User.prototype.isAdmin=function(){var e=require("ui/common/Login"),t=e.getUser();return t.getId()==this.getId()?!0:!1},User.prototype.loadFriends=function(){var e=this;Ti.Facebook.requestWithGraphPath("me/friends",{fields:"first_name,last_name,id,photo"},"GET",function(t){if(t.success){Ti.API.debug("friends loaded");var n=JSON.parse(t.result),r=n.data;e.friends=r}});var t="http://flair.me/search.php",n={type:"friends",accessToken:Ti.Facebook.getAccessToken()},r=Ti.Network.createHTTPClient({onload:function(t){var n=JSON.parse(this.responseText);e.friendsUsing=n.cars,e.friendsUsingString=n.friendsStr},onerror:function(e){Ti.API.error(e.error)},timeout:5e3});r.open("POST",t),r.send(n)},User.prototype.getAllFriends=function(){return this.friends},User.prototype.getUserFriends=function(){return this.friendsUsing},module.exports=User