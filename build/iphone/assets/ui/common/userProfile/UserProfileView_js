function _hr(){return Ti.UI.createView({backgroundImage:"images/feed/like_hr.png",height:2,bottom:0,width:"320"})}function tabbedBar(){var e=Ti.UI.createView({height:"40",width:"320",backgroundColor:"#999"}),t=Ti.UI.createView({height:Ti.UI.SIZE,width:Ti.UI.FILL}),n=Ti.UI.iOS.createTabbedBar({labels:[{enabled:!0,title:"cast"},{enabled:!0,title:"menu"}],backgroundColor:"#999",style:Ti.UI.iPhone.SystemButtonStyle.BAR,height:30,width:280,_tabViews:t,index:0});return e.add(n),n.addEventListener("singletap",function(e){e.index===0?(this._tabViews._foodView.hide(),this._tabViews._castView.show()):(this._tabViews._castView.hide(),this._tabViews._foodView.show())}),e}function loadUser(e,t){Ti.API.debug("loading user from server "+e);var n=require("ui/common/data/User");e==login.getUser().getId()?(t.user=login.getUser(),user=t.user,printDetails()):t.user=new n(e,function(e){Ti.API.info("userProfile.loadUser"),user=e,printDetails()})}function clearView(e,t){var n=t.children.length;for(var r=0;r<n;r++)t.remove(t.children[r]);if(e!==!0){var i=Ti.UI.createImageView({image:"images/loading_white.gif",width:"150",top:20});t.add(i)}}function printDetails(e){clearView(!0,view),clearView(!0,placeViewTopLayer),Ti.API.debug("UserProfile.printDetails"),photoView.setImage(user.getPhotoBig());var t=Ti.UI.createLabel({left:10,width:Ti.UI.SIZE,height:Ti.UI.SIZE,shadowColor:"#333333",color:"#fff",text:user.getName(),font:{fontSize:26,fontWeight:"bold"}});placeViewTopLayer.add(t);if(user.getPlace()||user.isAdmin())grayV=printPlace(user),view.add(grayV);if(user.getId())var n=require("ui/common/feed/FeedView"),r=new n(user.feed(),main);else view.add(userHasNotClaimed())}function userHasNotClaimed(){var e=Ti.UI.createView({layout:"horizontal",left:10,right:10,top:10});return e}function activation_code(e){var t=e.getPlace(),n=Ti.UI.createView({height:Ti.UI.SIZE,left:10,right:10,top:10,backgroundColor:"#fff",borderRadius:4,borderWidth:.5,borderColor:"#ddd",layout:"vertical"}),r=Ti.Map.createView({mapType:Ti.Map.STANDARD_TYPE,region:{latitude:t.lat,longitude:t.lng,latitudeDelta:.005,longitudeDelta:.005},animate:!0,regionFit:!0,userLocation:!0,touchEnabled:!1}),i=Ti.UI.createView({top:"0",height:"80",borderRadius:4,left:10,right:10,top:10});i.add(r),n.add(i);var s=Ti.UI.createLabel({left:10,right:10,top:10,color:"#2179ca",text:"Verification Code : "+t.code,font:{fontSize:20}});n.add(s);var o=Ti.UI.createView({height:Ti.UI.SIZE,left:0,top:0,layout:"horizontal"});n.add(o);var u=Ti.UI.createLabel({left:10,right:10,bottom:10,color:"#333",text:"Please call 1-866-291-9993 from "+t.name+" and enter your verification code.",font:{fontSize:14}});return o.add(u),n.addEventListener("singletap",function(){var e=require("ui/common/userProfile/SearchPlace");e.launch()}),n}function printPlace(e){var t=e.getPlace(),n=Ti.UI.createView({left:10,right:10,top:10,height:Ti.UI.SIZE,layout:"horizontal",backgroundColor:"#fff",borderRadius:4}),r=Ti.UI.createImageView({image:"images/profile/oscar_48.png",left:10,right:10,top:10,bottom:10,width:30,height:50}),i=Ti.UI.createView({height:Ti.UI.SIZE,left:10,right:10,top:10,bottom:10,layout:"vertical"});if(t&&!t.code){var s=Ti.UI.createLabel({left:0,width:"auto",color:"#eee",text:t.role,font:{fontSize:14}}),o=Ti.UI.createLabel({left:0,width:"auto",color:"#2179ca",shadowColor:"#aaa",shadowOffset:{x:1,y:1},text:t.name,font:{fontSize:18}}),u=Ti.UI.createView({width:"auto",height:Ti.UI.SIZE,layout:"horizontal",left:0});if(e.getId()==login.getUser().getId()){var a=Ti.UI.createImageView({image:"images/profile/settings2.png",left:0,right:5,height:25}),f=Ti.UI.createLabel({left:0,width:"auto",color:"#2179ca",text:"(edit)",font:{fontSize:14}});u.add(a),u.add(f),u.addEventListener("singletap",function(e){var t=require("ui/common/userProfile/EditRole");portal.open(t.init())})}s.addEventListener("singletap",function(){var e=require("ui/common/place/Place");portal.open(e.init(t))}),o.addEventListener("singletap",function(){var e=require("ui/common/place/Place");portal.open(e.init(t))}),i.add(s),i.add(o),i.add(u)}else if(t&&t.code)view.add(activation_code(e));else if(!t&&e.isAdmin()){var l=Ti.UI.createLabel({left:0,width:"auto",color:"#aaa",text:"(add new)",font:{fontSize:14}}),o=Ti.UI.createLabel({left:0,width:"auto",color:"#2179ca",text:"My Restaurant/Cafe",font:{fontSize:18}});i.add(o),i.add(l),i.addEventListener("singletap",function(){var e=require("ui/common/userProfile/SearchPlace");e.launch()})}return n.add(i),n}var view,user,grayV,photoView,main,placeViewTopLayer,portal=require("ui/common/Portal"),login=require("ui/common/Login");exports.init=function(e,t,n){var r={x:0,y:60};main=Ti.UI.createTableView({width:"320",backgroundColor:"#eee",separatorStyle:"NONE"}),main.userId=e,main.userName=t;var i=Ti.UI.createView({width:"100%",height:Ti.UI.SIZE,top:0,layout:"vertical"});view=Ti.UI.createView({width:"100%",height:Ti.UI.SIZE,top:0,layout:"vertical"});var s=Ti.UI.createImageView({image:"images/loading_white.gif",width:"50",top:0});photoView=Ti.UI.createImageView({image:n,width:320,height:200,top:0,backgroundColor:"#000"});var o=Ti.UI.createView({top:0,height:Ti.UI.FILL,width:"320",backgroundImage:"images/map_shade.png"});placeViewTopLayer=Ti.UI.createView({bottom:"10",height:Ti.UI.SIZE,width:"320",bubbleParent:!0,layout:"vertical"}),o.add(placeViewTopLayer),photoView.add(o),i.add(photoView);var u=Ti.UI.createTableViewRow({height:Ti.UI.SIZE});return u.add(i),i.add(_hr()),i.add(view),main.appendRow(u),main.contentScreen=view,main.userPhotoView=photoView,loadUser(e,main),main},exports.refresh=function(e){Ti.API.debug("in refresh "+e.getPlace()),user=e,printDetails(!0)}