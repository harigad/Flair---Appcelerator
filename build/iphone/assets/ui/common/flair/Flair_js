function printPlaces(){placesView=places.init(_startFlair),main.add(placesView);var e=Ti.UI.createAnimation();e.opacity=1,e.duration=300,main.open(e)}function _startFlair(e){_place=e,clear(main);var t=Ti.UI.createView({width:"100%",height:"100%",top:0,left:0,layout:"vertical",backgroundColor:"#fff"});t.add(_top(_flair));var n=Ti.UI.createScrollView({contentWidth:"100%",contentHeight:"auto",showVerticalScrollIndicator:!1,showHorizontalScrollIndicator:!1,width:"100%",top:0,left:0,height:120});_tableView=Ti.UI.createView({height:"auto",width:"100%",top:0,layout:"vertical"}),n.add(_tableView),t.add(n),main.add(t),_textField.focus()}function _update(e){_adv="",_adj="",_food="",_person="",_fid=0,_pid=0,_mode="";var t=e.getValue();t=t.replace(/^\s+|\s+$/g,"");var n=t.split(" ");Ti.API.debug("words le"+n.length);if(_adv===""){Ti.API.debug("searching adverbs");var r=_search_adv(n[0]);r.length===0?(Ti.API.error("adverbs invalid"),_print_last_word(n[0],!1)):r.length>1?(n.length>1&&(_adv=n[0]),_print_last_word(n[0],!0)):r.length===1?(_adv=n[0],_print_last_word(n[0],!0)):_print_last_word(n[0],!1)}if(_adv!==""&&_adj===""&&n.length>1){Ti.API.debug("searching adjectives ");var r=_search_adj(n[1]);r.length===0?(Ti.API.error("adjectives invalid"),_print_last_word(n[1],!1)):r.length>1?(n.length>2&&(_adj=n[n.length-1]),print_last_word(n[1],!0)):r.length===1?(_adj=n[1],_print_last_word(n[1],!0)):_print_last_word(n[1],!1)}if(_adv!==""&&_adj!==""&&_food===""&&n.length>2){Ti.API.debug("searching food");var i=t.lastIndexOf(_adj)+_adj.length,s=t.substring(i),o=s.split(" by "),u=o[0],r=_search_food(u);r.length>0?_print_last_word(u,!0):_print_last_word(u,!1),o.length>1&&(_food=u)}if(_food!==""&&t.lastIndexOf(" by ")>t.lastIndexOf(_food)&&o.length>1){Ti.API.debug("searching person");var a=o[1],r=_search_person(a);_print_last_word(" by ",!0),r.length>0?(_print_last_word(a,!0),_person=a,send_to_server()):(_print_last_word(a,!0),_person=a)}}function send_to_server(){if(_adj!==""&&_adv!==""&&_food!==""&&_person!==""){Ti.API.debug("looks like a good flair");var e="https://flair.me/nominate.php",t={},n,r=require("ui/common/place/Place"),n=r.init(_place);portal.open(n),main.close(),t.flair=_flair.id,t.place=_place.pid,t.adjective=_adv+" "+_adj,t.food=_food,t.recipientName=_person,t.accessToken=Ti.Facebook.getAccessToken();var i=Ti.Network.createHTTPClient({onload:function(e){var t=JSON.parse(this.responseText);t.status,Ti.API.debug("Flair sent to server")},onerror:function(e){Ti.API.error("Sending Flair to Server "+e.error)},timeout:5e3});i.open("POST",e),i.send(t)}}function _print_place(){}function _search_person(e){e=e.replace(/^\s+|\s+$/g,"");var t=[];return e==="hari"&&t.push({title:e}),_updateTable(t),t}function _search_adv(e){e=e.replace(/^\s+|\s+$/g,"");var t=[];return e==="absolutely"&&(t.push({title:e}),t.push({title:"absenty"}),t.push({title:"abbyness"}),t.push({title:"absoluteness"})),_updateTable(t),t}function _search_adj(e){e=e.replace(/^\s+|\s+$/g,"");var t=[];return e==="delicious"&&t.push({title:e}),_updateTable(t),t}function _search_food(e){e=e.replace(/^\s+|\s+$/g,""),e.lastIndexOf(" by")===e.length-3?e=e.substring(0,e.length-3):e.lastIndexOf(" b")===e.length-2&&(e=e.substring(0,e.length-2));var t=[];return e==="chips ahoy"&&t.push({title:e}),_updateTable(t),t}function _print_last_word(e,t){var n=_textField.getColor();t?n!=="#333333"&&_textField.setColor("#333333"):n!=="#990000"&&_textField.setColor("#990000")}function _updateTable(e){clear(_tableView);for(var t=0;t<e.length;t++){var n=Ti.UI.createView({left:0,right:0,top:0,bottom:0,width:"100%",height:"auto",layout:"horizontal"}),r=Ti.UI.createView({width:75,height:30,top:5,bottom:5,left:5,right:0}),i=Ti.UI.createLabel({left:5,height:"auto",width:"200",color:"#aaa",text:e[t].title,font:{fontSize:18}});n.add(r),n.add(i),t<e.length-1&&n.add(_hr()),_tableView.add(n)}}function _top(e){var t=_createThumb(e),n=Ti.UI.createView({left:5,top:5,width:230,height:"auto",layout:"vertical"}),r=Ti.UI.createView({left:0,width:"220",height:"auto",top:-5}),i=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.CANCEL});i.addEventListener("singletap",function(e){var t=require("ui/common/flair/Flair");t.close()});var s=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE}),o=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.SAVE});o.addEventListener("singletap",function(){send_to_server()});var u=Ti.UI.createToolbar({items:[i,s,o],animated:!1,backgroundColor:"#999",height:60,width:Ti.UI.FILL});_textField=Ti.UI.createTextArea({borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,color:"#333",keyboardToolbarColor:"#999",keyboardToolbar:u,top:10,left:0,width:"100%",height:"70",font:{fontSize:18},hintText:"Start Typing Here"}),_textField.addEventListener("change",function(){_update(this)}),r.add(_textField),n.add(r);var a=Ti.UI.createView({backgroundColor:"#eee",left:0,right:0,bottom:0,height:"85",layout:"horizontal",_data:e});return a.add(t),a.add(n),main.addEventListener("singletap",function(){Ti.API.debug("YAHOOOOOOOOOOOOOOOOOOOOOOOOOOOOO"),_textField.focus()}),a}function _createThumb(e){var t=Ti.UI.createView({width:75,height:75,top:5,bottom:5,left:5,right:0,backgroundImage:"images/feed/feed_flair_shadow.png",_data:e}),n=Ti.UI.createView({width:55,height:55,backgroundImage:"images/flairs/100/"+e.id+".png"});return t.add(n),t}function clear(e){Ti.API.debug("clearing tableView with items = "+e.children.length);for(var t=0;t<e.children.length;t++){var n=e.children[t];e.remove(n)}Ti.API.debug("clearing done with items = "+e.children.length)}function _hr(){return Ti.UI.createView({backgroundImage:"images/feed/hr.png",backgroundRepeat:!0,height:2,top:0,bottom:0,width:"100%"})}var _textField,_tableView,_adv,_adj,_food,_fid,_pid,_person,_mode,_flair,_place,portal=require("ui/common/Portal"),places=require("ui/common/flair/Places"),_search=require("ui/common/flair/Search"),main,placesView;exports.close=function(){var e=Ti.UI.createAnimation();e.opacity=0,e.duration=300,main.close(e)},exports.init=function(e){_flair=e,main=Ti.UI.createWindow({hideNavBar:!0,backgroundColor:"transparent",opacity:0}),printPlaces()}