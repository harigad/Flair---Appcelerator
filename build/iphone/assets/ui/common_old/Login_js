function isLoggedIn(){return Ti.Facebook.getLoggedIn()?user?!0:!1:!1}function loadUser(e){Ti.API.debug("login.loadUser");var t=require("ui/common/data/User");user=new t("me",function(){user.loadFriends(),e()})}function onLogin(e,t){Ti.API.debug("login sucessful");var n=Ti.App.Properties.listProperties();for(var r=0,i=n.length;r<i;r++)Ti.App.Properties.removeProperty(n[r]);loadUser(function(){Ti.API.debug("user load successful");var e=require("ui/common/data/DB");e.open(),e.load();var n=require("ui/common/Login");n.init(t),main.close()})}function show(e){if(Ti.Facebook.getLoggedIn()){onLogin(e);return}main=Ti.UI.createWindow({backgroundImage:"images/signup/bg.png"}),Ti.Facebook.addEventListener("login",function(t){onLogin(t,e)}),Ti.Facebook.addEventListener("logout",function(e){alert("Logged out")});var t=Ti.Facebook.createLoginButton({top:250,style:Ti.Facebook.BUTTON_STYLE_NORMAL});main.add(t),main.open()}function launchSignup(e){var t=require("ui/common/signup/Signup1");t.init(e)}var user,main;exports.init=function(e){isLoggedIn()?user?e():launchSignup(e):show(e)},exports.getUser=function(){return user}