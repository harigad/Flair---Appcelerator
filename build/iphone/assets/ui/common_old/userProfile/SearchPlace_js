function init(){main=Ti.UI.createWindow({backgroundColor:"#eee",hideNavBar:!0});var e=Ti.UI.createView({width:"100%",height:"auto",top:0,layout:"vertical"});main.add(e),e.add(_form());var t=Ti.UI.createScrollView({contentWidth:"auto",contentHeight:"auto",showVerticalScrollIndicator:!1,showHorizontalScrollIndicator:!1,width:320,top:0});e.add(t),results_view=Ti.UI.createView({width:"100%",height:"auto",top:5,layout:"vertical"}),t.add(results_view),_show_tip(),initialize()}function initialize(){if(user.getPlace().code){var e=require("ui/common/userProfile/AccessCode");e.launch(null,user.getPlace())}else main.open()}function _show_tip(){clear(results_view);var e=Ti.UI.createView({width:302,height:217,top:20,backgroundImage:"images/profile/whichrest.png"});results_view.add(e)}function _form(){var e=Ti.UI.createView({width:"100%",height:"auto",backgroundColor:"#fff",layout:"vertical"});_txtField=Ti.UI.createTextField({value:"",width:280,top:10,bottom:5,backgroundColor:"#eee",hintText:"restaurant/cafe",returnKeyType:Ti.UI.RETURNKEY_NEXT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,font:{fontSize:16}}),e.add(_txtField);var t=Ti.UI.createView({width:"100%",height:"auto",layout:"horizontal",left:20,right:20});e.add(t),_zipField=Ti.UI.createTextField({value:"",width:100,top:5,bottom:10,backgroundColor:"#eee",hintText:"zipcode",returnKeyType:Ti.UI.RETURNKEY_NEXT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_NONE,font:{fontSize:16}}),t.add(_zipField);var n=Ti.UI.createLabel({top:5,bottom:10,width:82.5,left:10,color:"#fff",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,text:"Search",backgroundColor:"#2179ca",borderRadius:4,font:{fontSize:18}});t.add(n),n.addEventListener("click",function(){_search()});var r=Ti.UI.createLabel({top:5,bottom:10,width:82.5,left:5,color:"#fff",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,text:"Cancel",backgroundColor:"#999",borderRadius:4,font:{fontSize:18}});return t.add(r),r.addEventListener("click",function(){var e=require("ui/common/userProfile/SearchPlace");e.close(!1)}),e}function _search(){Ti.API.debug("SearchPlace.search "+_txtField.value);var e=_txtField.value,t=_zipField.value;e=e.replace(/^\s+|\s+$/g,""),t=t.replace(/^\s+|\s+$/g,"");if(e===""||t===""){_show_tip();return}if(_isValidPostalCode(t,"US")!==!0){var n=Ti.UI.createAlertDialog({message:"Invalid ZipCode!",ok:"Okay",title:"Oops!"});n.show();return}var r=this,i="http://flair.me/search.php",s={type:"search",searchMode:"place",search:e,city:t,accessToken:Ti.Facebook.getAccessToken()};Ti.API.debug("User.load sending data "+s),clear(results_view);var o=Ti.Network.createHTTPClient({onload:function(e){var t=JSON.parse(this.responseText);for(var n=0;n<t.length;n++){var r=Ti.UI.createView({left:0,right:0,top:0,bottom:0,width:"100%",height:"auto",layout:"vertical",_data:t[n]}),i=Ti.UI.createLabel({left:20,height:"auto",width:"auto",color:"#2179ca",text:t[n].name,font:{fontSize:14}});r.add(i);var s=Ti.UI.createLabel({left:20,height:"auto",width:"auto",color:"#666",text:t[n].vicinity,font:{fontSize:12}});r.add(s),n<t.length-1&&r.add(_hr()),r.addEventListener("click",function(e){var t=require("ui/common/userProfile/AccessCode");t.launch(this._data)}),results_view.add(r)}},onerror:function(e){Ti.API.error("User.load error "+e)}});o.open("POST",i),o.send(s)}function clear(e){Ti.API.debug("clearing tableView with items = "+e.children.length);for(var t=0;t<e.children.length;t++){var n=e.children[t];e.remove(n)}Ti.API.debug("clearing done with items = "+e.children.length)}function _hr(){return Ti.UI.createView({backgroundImage:"images/feed/hr.png",backgroundRepeat:!0,height:2,top:5,bottom:5,width:"100%"})}function _isValidPostalCode(e,t){switch(t){case"US":postalCodeRegex=/^([0-9]{5})(?:[-\s]*([0-9]{4}))?$/;break;case"CA":postalCodeRegex=/^([A-Z][0-9][A-Z])\s*([0-9][A-Z][0-9])$/;break;default:postalCodeRegex=/^(?:[A-Z0-9]+([- ]?[A-Z0-9]+)*)?$/}return postalCodeRegex.test(e)}var login=require("ui/common/Login"),user=login.getUser(),results_view,_txtField,_zipField,main,nav_container,nav,portal=require("ui/common/Portal");exports.launch=function(){main?initialize():init()},exports.close=function(e){main.close();if(e){var t=require("ui/common/userProfile/UserProfileView");t.refresh()}}