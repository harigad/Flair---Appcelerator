function defineCloud(e){function n(e,t,n){if(void 0===t)throw"Argument "+e+" was not provided!";if(typeof t!=n)throw"Argument "+e+" was an unexpected type! Expected: "+n+", Received: "+typeof t}function r(t,r){n("data",t,"object"),n("callback",r,"function"),o(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json");var i=void 0==e.useSecure?!0:e.useSecure;e.debug&&Ti.API.info('ACS Request: { url: "'+this.url+'", verb: "'+this.verb+'", secure: '+(i?"YES":"NO")+", data: "+JSON.stringify(t)+" })"),g.send(this.url,this.verb,t,i,function(t){if(r){var n=t.response||{};t.meta&&"ok"==t.meta.status?(n.success=!0,n.error=!1,n.meta=t.meta,e.debug&&Ti.API.info(JSON.stringify(n))):(n.success=!1,n.error=!0,n.code=t.meta?t.meta.code:t.statusCode,n.message=t.meta?t.meta.message:t.message||t.statusText,e.debug&&Ti.API.error(n.code+": "+n.message)),r(n)}})}function i(){r.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function s(e){r.call(this,{},e)}function o(e){e.restNamespace||(e.restNamespace=e.property.toLowerCase()),e.restMethod||(e.restMethod=e.method.toLowerCase())}function u(t,r){n("callback",r,"function");var i={};i.useSecure=void 0==e.useSecure?!0:e.useSecure,i.params=t||{},i.params.cb=function(t){if(r){var n=t||{};t&&t.access_token?(n.success=!0,n.error=!1,e.debug&&Ti.API.info("ACS Token: "+t.access_token+" Expires: "+t.expires_in)):(n.success=!1,n.error=!0,n.message="Cancelled",e.debug&&Ti.API.error("ACS "+n.message)),r(n)}},g.secureSend(this.method,i)}function a(){u.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function f(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776,a=0;a<e.length;a+=16){for(var f=r,c=i,h=s,p=o,d=u,v=0;80>v;v++){n[v]=16>v?e[a+v]:(n[v-3]^n[v-8]^n[v-14]^n[v-16])<<1|(n[v-3]^n[v-8]^n[v-14]^n[v-16])>>>31;var m=r<<5|r>>>27,g;g=20>v?i&s|~i&o:40>v?i^s^o:60>v?i&s|i&o|s&o:i^s^o,m=l(l(m,g),l(l(u,n[v]),20>v?1518500249:40>v?1859775393:60>v?-1894007588:-899497514)),u=o,o=s,s=i<<30|i>>>2,i=r,r=m}r=l(r,f),i=l(i,c),s=l(s,h),o=l(o,p),u=l(u,d)}return[r,i,s,o,u]}function l(e,t){var n=(e&65535)+(t&65535);return(e>>16)+(t>>16)+(n>>16)<<16|n&65535}function c(e){for(var t=[],n=(1<<m)-1,r=0;r<e.length*m;r+=m)t[r>>5]|=(e.charCodeAt(r/m)&n)<<32-m-r%32;return t}function h(e,n,r,i){var s=!1;return n?(this.oauthKey=e,this.oauthSecret=n):this.appKey=e,this.apiBaseURL=r?r:t.sdk.url.baseURL,this.authBaseURL=i?i:t.sdk.url.authBaseURL,this.useThreeLegged=function(e){s=e,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return s},this}var t,p={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};p.build=function y(e,t){var n=t.children||[],r;for(r in n)if(n.hasOwnProperty(r)){var i=n[r],s=i.propertyTypes||t.propertyTypes||{};s.children=p.PROPERTY_TYPE_IGNORE;for(var o in t)if(t.hasOwnProperty(o))switch(s[o]||p.PROPERTY_TYPE_ONLY_LATEST){case p.PROPERTY_TYPE_ONLY_LATEST:i[o]=void 0===i[o]?t[o]:i[o];break;case p.PROPERTY_TYPE_SLASH_COMBINE:var u=[];t[o]&&u.push(t[o]),i[o]&&u.push(i[o]),i[o]=u.join("/")}i.method&&!i.children?e[i.method]=function(e){return function(){return e.executor.apply(e,arguments)}}(i):i.property&&y(e[i.property]={},i)}},p.build(e,{verb:"GET",executor:r,children:[{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),g.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),g.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"getChatGroups",restMethod:"get_chat_groups",executor:i}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:i},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:i}]},{property:"Objects",executor:function(e,t){var i;e&&"object"==typeof e&&(n("data.classname",e.classname,"string"),o(this),this.url=this.restNamespace+"/"+e.classname+"/"+this.restMethod+".json",i=e.classname,delete e.classname),r.call(this,e,t),e.classname=i},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:i},{method:"queryOccurrences",restMethod:"query/occurrences",executor:i},{method:"search",executor:i},{method:"searchOccurrences",restMethod:"search/occurrences",executor:i},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:i},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:i},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:i},{method:"showSent",restMethod:"show/sent",executor:i},{method:"showThreads",restMethod:"show/threads",executor:i},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:i},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:i},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:i}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:i},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:s}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"search"},{method:"query",executor:i}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:s},{method:"search",executor:i},{method:"query",executor:i},{method:"update",verb:"PUT"},{method:"logout",executor:function(e){r.call(this,{},function(t){g.reset(),e(t)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var e=arguments;r.call(this,2==e.length?e[0]:{},function(t){g.reset(),(2==e.length?e[1]:e[0])(t)})}},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"secureCreate",executor:a},{method:"secureLogin",executor:a},{method:"secureStatus",executor:function(){return g.checkStatus()}}]}]});var d;null==d&&(d={}),d.setProperties=function(e,t){if(null!=e&&null!=t)for(var n in t)e[n]=t[n];return e},d.setProperties(d,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="";0<e.length;++e)""!=t&&(t+="&"),t+=d.percentEncode(e[0]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return d.decodeForm(e+"");if(e instanceof Array)return e;var t=[],n;for(n in e)t.push([n,e[n]]);return t},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return d.getParameterMap(d.decodeForm(e+""));if(e instanceof Array){for(var t={},n=0;n<e.length;++n){var r=e[n][0];void 0===t[r]&&(t[r]=e[n][1])}return t}return e},getParameter:function(e,t){if(e instanceof Array){for(var n=0;n<e.length;++n)if(e[n][0]==t)return e[n][1];return null}return d.getParameterMap(e)[t]},formEncode:function(e){for(var t="",e=d.getParameterList(e),n=0;n<e.length;++n){var r=e[n][1];null==r&&(r=""),""!=t&&(t+="&"),t+=d.percentEncode(e[n][0])+"="+d.percentEncode(r)}return t},decodeForm:function(e){for(var t=[],e=e.split("&"),n=0;n<e.length;++n){var r=e[n];if(""!=r){var i=r.indexOf("="),s;0>i?(s=d.decodePercent(r),r=null):(s=d.decodePercent(r.substring(0,i)),r=d.decodePercent(r.substring(i+1))),t.push([s,r])}}return t},setParameter:function(e,t,n){var r=e.parameters;if(r instanceof Array){for(e=0;e<r.length;++e)r[e][0]==t&&(void 0===n?r.splice(e,1):(r[e][1]=n,n=void 0));void 0!==n&&r.push([t,n])}else r=d.getParameterMap(r),r[t]=n,e.parameters=r},setParameters:function(e,t){for(var n=d.getParameterList(t),r=0;r<n.length;++r)d.setParameter(e,n[r][0],n[r][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var n=d.getParameterMap(e.parameters);null==n.oauth_consumer_key&&d.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==n.oauth_token&&null!=t.token&&d.setParameter(e,"oauth_token",t.token),null==n.oauth_version&&d.setParameter(e,"oauth_version","1.0"),null==n.oauth_timestamp&&d.setParameter(e,"oauth_timestamp",d.timestamp()),null==n.oauth_nonce&&d.setParameter(e,"oauth_nonce",d.nonce(6)),d.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){d.setParameter(e,"oauth_timestamp",d.timestamp()),d.setParameter(e,"oauth_nonce",d.nonce(6))},addToURL:function(e,t){newURL=e;if(null!=t){var n=d.formEncode(t);0<n.length&&(newURL=0>e.indexOf("?")?newURL+"?":newURL+"&",newURL+=n)}return newURL},getAuthorizationHeader:function(e,t){for(var n='OAuth realm="'+d.percentEncode(e)+'"',r=d.getParameterList(t),i=0;i<r.length;++i){var s=r[i],o=s[0];0==o.indexOf("oauth_")&&(n+=","+d.percentEncode(o)+'="'+d.percentEncode(s[1])+'"')}return n},correctTimestamp:function(e){d.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+d.timeCorrectionMsec;return Math.floor(e/1e3)},nonce:function(e){for(var t=d.nonce.CHARS,n="",r=0;r<e;++r)var i=Math.floor(Math.random()*t.length),n=n+t.substring(i,i+1);return n}}),d.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",d.declareClass=function(e,t,n){var r=e[t];e[t]=n;if(null!=n&&null!=r)for(var i in r)"prototype"!=i&&(n[i]=r[i]);return n},d.declareClass(d,"SignatureMethod",function(){}),d.setProperties(d.SignatureMethod.prototype,{sign:function(e){var t=this.getSignature(d.SignatureMethod.getBaseString(e));return d.setParameter(e,"oauth_signature",t),t},initialize:function(e,t){var n;n=null!=t.accessorSecret&&9<e.length&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=d.percentEncode(n)+"&"+d.percentEncode(t.tokenSecret)}}),d.setProperties(d.SignatureMethod,{sign:function(e,t){var n=d.getParameterMap(e.parameters).oauth_signature_method;if(null==n||""==n)n="HMAC-SHA1",d.setParameter(e,"oauth_signature_method",n);d.SignatureMethod.newMethod(n,t).sign(e)},newMethod:function(e,t){var n=d.SignatureMethod.REGISTERED[e];if(null!=n){var r=new n;return r.initialize(e,t),r}var n=Error("signature_method_rejected"),i="";for(r in d.SignatureMethod.REGISTERED)""!=i&&(i+="&"),i+=d.percentEncode(r);throw n.oauth_acceptable_signature_methods=i,n},REGISTERED:{},registerMethodClass:function(e,t){for(var n=0;n<e.length;++n)d.SignatureMethod.REGISTERED[e[n]]=t},makeSubclass:function(e){var t=d.SignatureMethod,n=function(){t.call(this)};return n.prototype=new t,n.prototype.getSignature=e,n.prototype.constructor=n},getBaseString:function(e){var t=e.action,n=t.indexOf("?");if(0>n)n=e.parameters;else for(var n=d.decodeForm(t.substring(n+1)),r=d.getParameterList(e.parameters),i=0;i<r.length;++i)n.push(r[i]);return d.percentEncode(e.method.toUpperCase())+"&"+d.percentEncode(d.SignatureMethod.normalizeUrl(t))+"&"+d.percentEncode(d.SignatureMethod.normalizeParameters(n))},normalizeUrl:function(e){var t=d.SignatureMethod.parseUri(e),e=t.protocol.toLowerCase(),n=t.authority.toLowerCase();if("http"==e&&80==t.port||"https"==e&&443==t.port){var r=n.lastIndexOf(":");0<=r&&(n=n.substring(0,r))}return(t=t.path)||(t="/"),e+"://"+n+t},parseUri:function(e){for(var t="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),n={},r=14;r--;)n[t[r]]=e[r]||"";return n},normalizeParameters:function(e){if(null==e)return"";for(var t=d.getParameterList(e),e=[],n=0;n<t.length;++n){var r=t[n];"oauth_signature"!=r[0]&&e.push([d.percentEncode(r[0])+" "+d.percentEncode(r[1]),r])}e.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),t=[];for(n=0;n<e.length;++n)t.push(e[n][1]);return d.formEncode(t)}}),d.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],d.SignatureMethod.makeSubclass(function(){return this.key})),d.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],d.SignatureMethod.makeSubclass(function(e){v="=";var t=this.key,n=c(t);16<n.length&&(n=f(n,t.length*m));for(var r=Array(16),t=Array(16),i=0;16>i;i++)r[i]=n[i]^909522486,t[i]=n[i]^1549556828;e=f(r.concat(c(e)),512+e.length*m),e=f(t.concat(e),672),n="";for(t=0;t<4*e.length;t+=3){r=(e[t>>2]>>8*(3-t%4)&255)<<16|(e[t+1>>2]>>8*(3-(t+1)%4)&255)<<8|e[t+2>>2]>>8*(3-(t+2)%4)&255;for(i=0;4>i;i++)n=8*t+6*i>32*e.length?n+v:n+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-i)&63)}return n}));var v="",m=8;h.prototype.sendRequest=function(e,n,r,i,s){var o=t.js.sdk.utils.getAuthType(this);if(o==t.constants.unknown)s(t.constants.noAppKeyError);else{var u="",u=i?u+t.sdk.url.https:u+t.sdk.url.http,u=u+(this.apiBaseURL+"/"+t.sdk.url.version+"/"+e),u=o==t.constants.app_key?u+(t.constants.keyParam+this.appKey):u+(t.constants.oauthKeyParam+this.oauthKey);null==r&&(r={}),n=n?n.toUpperCase():t.constants.get_method,r[t.constants.suppressCode]="true",this.isThreeLegged()||(i=t.js.sdk.utils.getCookie(t.constants.sessionId),i||(i=this.session_id),i&&(u=-1!=u.indexOf("?")?u+("&"+t.constants.sessionId+"="+i):u+("?"+t.constants.sessionId+"="+i))),this.isThreeLegged()&&(!this.accessToken&&(i=this.getSession())&&(this.accessToken=i.access_token),this.accessToken&&(r[t.constants.accessToken]=this.accessToken)),i=r;if(Ti.App.analytics){var a=i.analytics||{};a.id=Ti.Platform.createUUID(),Ti.Platform.id&&(a.mid=Ti.Platform.id),a.aguid=Ti.App.guid,a.event="cloud."+e.replace(/\//g,".").replace(/\.json/,""),a.deploytype=Ti.App.deployType||"development",a.sid=Ti.App.sessionId,i.ti_analytics=JSON.stringify(a)}r=t.js.sdk.utils.cleanInvalidData(r);if(e=t.js.sdk.utils.getFileObject(r)){try{var f;f=e.toString().match(/TiFilesystemFile/)?e.read():e;if(!f){s(t.constants.fileLoadError);return}r[t.constants.file]?(delete r[t.constants.file],r[t.constants.file]=f):r[t.constants.photo]&&(delete r[t.constants.photo],r[t.constants.photo]=f)}catch(l){s(t.constants.fileLoadError);return}f={};if(o==t.constants.oauth||o==t.constants.three_legged_oauth)o={method:n,action:u,parameters:[]},t.js.sdk.utils.populateOAuthParameters(o.parameters,this.oauthKey),this.oauthSecret&&d.completeRequest(o,{consumerSecret:this.oauthSecret}),f[t.constants.oauth_header]=d.getAuthorizationHeader("",o.parameters)}else if(f={},o==t.constants.oauth||o==t.constants.three_legged_oauth){var o={method:n,action:u,parameters:[]},c;for(c in r)r.hasOwnProperty(c)&&o.parameters.push([c,r[c]]);t.js.sdk.utils.populateOAuthParameters(o.parameters,this.oauthKey),this.oauthSecret&&d.completeRequest(o,{consumerSecret:this.oauthSecret}),f[t.constants.oauth_header]=d.getAuthorizationHeader("",o.parameters)}t.js.sdk.utils.sendAppceleratorRequest(u,n,r,f,s,this)}},h.prototype.sendAuthRequest=function(e){if(t.js.sdk.utils.getAuthType(this)!==t.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},n=!1;"boolean"==typeof e.useSecure&&(n=e.useSecure);var r="",r=n?r+t.sdk.url.https:r+t.sdk.url.http,r=r+this.authBaseURL,r=r+"/oauth/authorize"+(t.constants.clientIdParam+this.oauthKey),r=r+(t.constants.responseTypeParam+"token"),e=e.params||{};e.action="login",e.url=r;var i=this,s=e.cb;s&&delete e.cb,t.js.sdk.ui(e,function(e){i.saveSession(e),s&&s(e)})}},h.prototype.signUpRequest=function(e){if(t.js.sdk.utils.getAuthType(this)!==t.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},n=!1;"boolean"==typeof e.useSecure&&(n=e.useSecure);var r="",r=n?r+t.sdk.url.https:r+t.sdk.url.http,r=r+this.authBaseURL,r=r+"/users/sign_up"+(t.constants.clientIdParam+this.oauthKey),e=e.params||{};e.action="signup",e.url=r;var i=this,s=e.cb;s&&delete e.cb,t.js.sdk.ui(e,function(e){i.saveSession(e),s&&s(e)})}},h.prototype.saveSession=function(e){return!e||!e.access_token?this.authorized=!1:(t.js.sdk.utils.setCookie(t.constants.accessToken,e.access_token),t.js.sdk.utils.setCookie(t.constants.expiresIn,e.expires_in),this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0)},h.prototype.getSession=function(){var e={};return e.access_token=t.js.sdk.utils.getCookie(t.constants.accessToken),e.expires_in=t.js.sdk.utils.getCookie(t.constants.expiresIn),e.access_token?(this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0,e):this.authorized=!1},h.prototype.clearSession=function(){t.js.sdk.utils.setCookie(t.constants.accessToken,""),t.js.sdk.utils.setCookie(t.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},h.prototype.checkStatus=function(){return this.getSession()?!0:!1},t=void 0,t={constants:{},js:{}},t.js.sdk={},t.js.sdk.utils={},t.sdk={},t.sdk.url={},t.sdk.url.http="http://",t.sdk.url.https="https://",t.sdk.url.baseURL="api.cloud.appcelerator.com",t.sdk.url.authBaseURL="secure-identity.cloud.appcelerator.com",t.sdk.url.version="v1",t.constants.get_method="GET",t.constants.post_method="POST",t.constants.put_method="PUT",t.constants.delete_method="DELETE",t.constants.app_key=1,t.constants.oauth=2,t.constants.three_legged_oauth=3,t.constants.unknown=-1,t.constants.keyParam="?key=",t.constants.oauthKeyParam="?oauth_consumer_key=",t.constants.clientIdParam="?client_id=",t.constants.redirectUriParam="&redirect_uri=",t.constants.responseTypeParam="&response_type=",t.constants.accessToken="access_token",t.constants.expiresIn="expires_in",t.constants.appKey="app_key",t.constants.json="json",t.constants.sessionId="_session_id",t.constants.sessionCookieName="Cookie",t.constants.responseCookieName="Set-Cookie",t.constants.file="file",t.constants.suppressCode="suppress_response_codes",t.constants.response_wrapper="response_wrapper",t.constants.photo="photo",t.constants.method="_method",t.constants.name="name",t.constants.value="value",t.constants.oauth_header="Authorization",t.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},t.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},t.js.sdk.utils.getSessionParams=function(){var e=null,n=t.js.sdk.utils.getCookie(t.constants.sessionId);return n&&(e=t.constants.sessionId+"="+n),e},t.js.sdk.utils.cookieMap=[],t.js.sdk.utils.cookieMap[t.constants.sessionId]="sessionId",t.js.sdk.utils.cookieMap[t.constants.accessToken]="accessToken",t.js.sdk.utils.cookieMap[t.constants.expiresIn]="expiresIn",t.js.sdk.utils.getCookie=function(n){return(n=t.js.sdk.utils.cookieMap[n])&&e[n]||null},t.js.sdk.utils.setCookie=function(n,r){var i=t.js.sdk.utils.cookieMap[n];i&&(""===r?delete e[i]:e[i]=r)},t.js.sdk.utils.deleteCookie=function(n){(n=t.js.sdk.utils.cookieMap[n])&&delete e[n]},t.js.sdk.utils.getAuthType=function(e){if(e){if(e.isThreeLegged())return t.constants.three_legged_oauth;if(e.appKey)return t.constants.app_key;if(e.oauthKey&&e.oauthSecret)return t.constants.oauth}return t.constants.unknown},t.js.sdk.utils.getFileObject=function(e){if(e)for(var n in e)if(e.hasOwnProperty(n)&&(n==t.constants.photo||n==t.constants.file))return e[n];return null},t.js.sdk.utils.cleanInvalidData=function(e){if(e){for(var n in e)if(e.hasOwnProperty(n)){null==e[n]&&delete e[n];if("object"==typeof e[n]){if(n==t.constants.photo||n==t.constants.file)continue;e[n]=JSON.stringify(e[n])}if(!0===e[n]||!1===e[n])e[n]=e[n]?1:0}return e}return{}},t.js.sdk.utils.uploadMessageCallback=function(e){return e&&e.data?JSON.parse(e.data):{}},t.js.sdk.utils.getOAuthParameters=function(e){var t="";if(e)for(var e=d.getParameterList(e),n=0;n<e.length;++n){var r=e[n],i=r[0];0==i.indexOf("oauth_")&&"oauth_token"!=i&&(t+="&"+d.percentEncode(i)+"="+d.percentEncode(r[1]))}return 0<t.length&&(t=t.substring(1)),t},t.js.sdk.utils.populateOAuthParameters=function(e,t){e&&t&&(e.push(["oauth_version","1.0"]),e.push(["oauth_consumer_key",t]),e.push(["oauth_signature_method","HMAC-SHA1"]),e.push(["oauth_nonce",d.nonce(15)]))},t.js.sdk.utils.sendAppceleratorRequest=function(n,r,i,s,o,u){var a=Ti.Network.createHTTPClient({timeout:6e4,onsendstream:function(t){e.onsendstream&&e.onsendstream({url:n,progress:t.progress})},ondatastream:function(t){e.ondatastream&&e.ondatastream({url:n,progress:t.progress})},onerror:function(e){var t={},n=this.responseText;try{(n=n.trim())&&0<n.length&&(t=JSON.parse(n))}catch(r){t=r}t.message||(t.message=e.error),t.error=!0,t.statusText=this.statusText,t.status=this.status,t.meta&&(t.metaString=JSON.stringify(t.meta)),o(t)},onload:function(){var e=JSON.parse(this.responseText);if(e&&e.meta&&(e.metaString=JSON.stringify(e.meta),e.meta.session_id)){var n=e.meta.session_id;t.js.sdk.utils.setCookie(t.constants.sessionId,n),u.session_id=n}o(e)}}),f=n;if(r.toUpperCase()==t.constants.get_method||r.toUpperCase()==t.constants.delete_method){var l="",c;for(c in i)i.hasOwnProperty(c)&&(l+="&"+c+"="+d.percentEncode(i[c]));0<l.length&&(f=0<n.indexOf("?")?f+l:f+("?"+l.substring(1)),i={})}e.debug&&(Ti.API.info(r+": "+f),Ti.API.info("header: "+JSON.stringify(s)),Ti.API.info("data: "+JSON.stringify(i))),a.open(r,f),"mobileweb"!=Ti.Platform.osname&&a.setRequestHeader("Accept-Encoding","gzip,deflate");if(s)for(c in s)s.hasOwnProperty(c)&&a.setRequestHeader(c,s[c]);a.send(i)},t.js.sdk.utils.decodeQS=function(e){var t=decodeURIComponent,n={},e=e.split("&"),r,i;for(r=0;r<e.length;r++)(i=e[r].split("=",2))&&i[0]&&(n[t(i[0])]=t(i[1]));return n},t.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},t.js.sdk.utils.copy=function(e,t,n,r){for(var i in t)if(n||"undefined"==typeof e[i])e[i]=r?r(t[i]):t[i];return e};var g={session:null,fetchSetting:function(e,t){var n,r="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(n=Ti.App.Properties.getString(e+"-"+r))&&"undefined"!=n||(n=Ti.App.Properties.getString(e))&&"undefined"!=n?n:t},fetchSession:function(){var e=g.fetchSetting("acs-api-key",null),n=g.fetchSetting("acs-base-url",t.sdk.url.baseURL),r=g.fetchSetting("acs-authbase-url",t.sdk.url.authBaseURL),i=g.fetchSetting("acs-oauth-key",null),s=g.fetchSetting("acs-oauth-secret",null);if(i&&s)return new h(i,s,n,r);if(e)return new h(e,null,n,r);throw"ACS CREDENTIALS NOT SPECIFIED!"}};return g.getSession=function(){return null==g.session&&(g.session=g.fetchSession()),g.session},g.send=function(e,t,n,r,i){g.getSession().sendRequest(e,t,n,r,i)},g.hasStoredSession=function(){return!!t.js.sdk.utils.getCookie(t.constants.sessionId)},g.retrieveStoredSession=function(){return t.js.sdk.utils.getCookie(t.constants.sessionId)},g.reset=function(){t.js.sdk.utils.deleteCookie(t.constants.sessionId),g.session&&(g.session.clearSession(),g.session=null)},g.secureSend=function(e,t){var n=g.getSession();n.useThreeLegged(!0),"secureCreate"===e?n.signUpRequest(t):"secureLogin"===e&&n.sendAuthRequest(t)},g.checkStatus=function(){return g.getSession().checkStatus()},t.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(n){function r(e){var n=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(e.url));if(n&&3==n.length){var a=null;if("success"==n[1])a=t.js.sdk.utils.decodeQS(n[2]);else if("cancel"!=n[1])return;s.removeEventListener("beforeload",r),s.removeEventListener("load",r),u=a,i&&i.close()}o&&"load"==e.type&&(i.remove(o),o=null)}e.debug&&Ti.API.info("ThreeLegged Request url: "+n.url);var i=Ti.UI.createWindow({modal:!0,title:n.params.title||"Appcelerator Cloud Service"}),s=Ti.UI.createWebView({url:n.url,scalesPageToFit:!1,showScrollbars:!0}),o=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100}),u;s.addEventListener("beforeload",r),s.addEventListener("load",r),i.addEventListener("close",function(){n&&(n.cb&&n.cb(u),s=i=o=n=u=null)});if("android"!=Ti.Platform.osname){var a=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});a.addEventListener("click",function(){i.close()}),i.rightNavButton=a}i.add(s),i.add(o),i.open()},processParams:function(e,n){return{cb:n,url:e.url+t.constants.redirectUriParam+t.js.sdk.UIManager.redirect_uri,params:e}}},t.js.sdk.ui=function(e,n){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(e.action){var r=t.js.sdk.UIManager.processParams(e,n);r&&t.js.sdk.UIManager.displayModal(r)}else alert('"action" is a required parameter for com.cocoafish.js.sdk.ui().')},e}defineCloud(exports)